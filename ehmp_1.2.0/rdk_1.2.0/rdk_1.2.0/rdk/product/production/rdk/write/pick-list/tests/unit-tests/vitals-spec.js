/*jslint node: true */
/*global describe, it, before, beforeEach, after, afterEach, spyOn, expect, runs, waitsFor */
'use strict';

var log = require('bunyan').createLogger({
    name: 'vitals-pick-list',
    level: 'warn'
});

var parseRpc = require('../../parsers/vitals-parser').parseVitals;

var message2parse = "V^1^BLOOD PRESSURE^BP^BP^210^110^100^60\r\nC^1^LOCATION\r\nQ^1^R ARM^RA\r\nQ^2^L ARM^LA\r\nQ^3^R LEG^RL\r\nQ^4^L LEG^LL\r\nQ^23^RADIAL^Rad\r\nQ^53^FEMORAL^Fem\r\nQ^57^BRACHIAL^Bra\r\nC^2^METHOD\r\nQ^59^PALPATED^Pal\r\nQ^60^DOPPLER^Dop\r\nQ^64^CUFF^Cu\r\nQ^65^NON-INVASIVE^N-I\r\nQ^98^CUFF-AUTOMATED^CA\r\nQ^101^MONITOR^Mo\r\nQ^110^CUFF-MANUAL^CM\r\nQ^119^AT REST^AR\r\nQ^121^WITH ACTIVITY^Act\r\nQ^122^INVASIVE^I\r\nQ^123^ARTERIAL LINE^AL\r\nQ^124^AFTER EXERCISE^AE\r\nC^3^POSITION\r\nQ^50^SITTING^Sit\r\nQ^51^STANDING^St\r\nQ^52^LYING^Ly\r\nQ^104^SEMIFOWLERS^Sfl\r\nQ^116^TRENDELENBURG^Tr\r\nC^6^CUFF SIZE\r\nQ^66^ADULT^Ad\r\nQ^67^SM ADULT^SmA\r\nQ^68^LG ADULT^LgA\r\nQ^70^PEDIATRIC^Ped\r\nQ^90^ADULT CUFF^AC\r\nQ^100^LG ADULT CUFF^LAC\r\nQ^102^PEDIATRIC CUFF^PdC\r\nQ^125^SM ADULT CUFF^SAC\r\nQ^126^THIGH CUFF^ThC\r\nV^2^TEMPERATURE^T^TMP^102^95\r\nC^1^LOCATION\r\nQ^5^AXILLARY^Ax\r\nQ^6^ORAL^O\r\nQ^7^RECTAL^R\r\nQ^40^CORE^C\r\nQ^45^TYMPANIC^Tym\r\nQ^46^SKIN^Sk\r\nQ^97^TEMPORAL^Tem\r\nV^3^RESPIRATION^R^RS^30^8\r\nC^2^METHOD\r\nQ^47^SPONTANEOUS^S\r\nQ^48^CONTROLLED VENTILATOR^CV\r\nQ^49^ASSISTED VENTILATOR^AV\r\nQ^88^VENTILATOR^Ven\r\nQ^101^MONITOR^Mo\r\nQ^119^AT REST^AR\r\nQ^121^WITH ACTIVITY^Act\r\nQ^124^AFTER EXERCISE^AE\r\nC^3^POSITION\r\nQ^50^SITTING^Sit\r\nQ^51^STANDING^St\r\nQ^52^LYING^Ly\r\nV^5^PULSE^P^PU^120^60\r\nC^1^LOCATION\r\nQ^22^APICAL^Ap\r\nQ^23^RADIAL^Rad\r\nQ^24^PERIPHERAL^Per\r\nQ^25^BILATERAL PERIPHERALS^BiP\r\nQ^38^CAROTID^Car\r\nQ^39^OTHER^Oth\r\nQ^53^FEMORAL^Fem\r\nQ^54^POPLITEAL^Pop\r\nQ^55^POSTERIOR TIBIAL^PT\r\nQ^56^DORSALIS PEDIS^DP\r\nQ^57^BRACHIAL^Bra\r\nQ^58^ULNAR^Uln\r\nQ^118^AV FISTULA^AVF\r\nC^2^METHOD\r\nQ^59^PALPATED^Pal\r\nQ^60^DOPPLER^Dop\r\nQ^61^AUSCULTATE^Aus\r\nQ^65^NON-INVASIVE^N-I\r\nQ^99^LEAD^L\r\nQ^101^MONITOR^Mo\r\nQ^119^AT REST^AR\r\nQ^121^WITH ACTIVITY^Act\r\nQ^122^INVASIVE^I\r\nQ^124^AFTER EXERCISE^AE\r\nC^3^POSITION\r\nQ^50^SITTING^Sit\r\nQ^51^STANDING^St\r\nQ^52^LYING^Ly\r\nQ^104^SEMIFOWLERS^Sfl\r\nC^5^SITE\r\nQ^62^RIGHT^Rt\r\nQ^63^LEFT^Lt\r\nV^8^HEIGHT^HT^HT^\r\nC^4^QUALITY\r\nQ^42^ACTUAL^A\r\nQ^43^ESTIMATED^E\r\nQ^114^STATED^Sta\r\nQ^127^ESTIMATED BY ARM SPAN^EAS\r\nV^9^WEIGHT^WT^WT^\r\nC^2^METHOD\r\nQ^71^CHAIR^Ch\r\nQ^72^BED^B\r\nQ^91^STANDING WEIGHT^SW\r\nQ^92^WITH CAST OR BRACE^WCB\r\nQ^93^WITH PROSTHESIS^WP\r\nQ^94^WITHOUT PROSTHESIS^WOP\r\nQ^106^LIFT SCALE^LS\r\nQ^115^WHEELCHAIR SCALE^WcS\r\nC^4^QUALITY\r\nQ^42^ACTUAL^A\r\nQ^43^ESTIMATED^E\r\nQ^44^DRY^D\r\nQ^114^STATED^Sta\r\nV^10^ABDOMINAL GIRTH^AG^AG^\r\nV^11^AUDIOMETRY^AUD^AUD^\r\nV^12^FUNDAL HEIGHT^FH^FH^\r\nV^13^FETAL HEART TONES^FT^FT^\r\nV^14^HEAD CIRCUMFERENCE^HC^HC^\r\nV^15^HEARING^HE^HE^\r\nV^16^TONOMETRY^TON^TON^\r\nV^17^VISION CORRECTED^VC^VC^\r\nV^18^VISION UNCORRECTED^VU^VU^\r\nV^19^CENTRAL VENOUS PRESSURE^CVP^^80^10^50\r\nV^20^CIRCUMFERENCE/GIRTH^CG^^\r\nC^1^LOCATION\r\nQ^39^OTHER^Oth\r\nQ^69^THIGH^Thi\r\nQ^73^HEAD^Hd\r\nQ^74^ABDOMINAL^Abd\r\nQ^75^CALF^Clf\r\nQ^76^LOWER ARM^LrA\r\nQ^77^UPPER ARM^UpA\r\nQ^78^WRIST^Wri\r\nQ^79^ANKLE^Ank\r\nQ^108^NECK^Ne\r\nQ^111^KNEE^Kn\r\nQ^129^HIP^Hip\r\nC^5^SITE\r\nQ^62^RIGHT^Rt\r\nQ^63^LEFT^Lt\r\nV^21^PULSE OXIMETRY^PO2^PO2^\r\nC^2^METHOD\r\nQ^48^CONTROLLED VENTILATOR^CV\r\nQ^49^ASSISTED VENTILATOR^AV\r\nQ^80^MASK^M\r\nQ^81^T-PIECE^TP\r\nQ^82^FACE TENT^FT\r\nQ^83^AEROSOL/HUMIDIFIED MASK^AM\r\nQ^84^NASAL CANNULA^NC\r\nQ^85^NON RE-BREATHER^NRB\r\nQ^86^PARTIAL RE-BREATHER^PRB\r\nQ^87^TRACHEOSTOMY COLLAR^TC\r\nQ^88^VENTILATOR^Ven\r\nQ^89^VENTURI MASK^VM\r\nQ^95^WITH AMBULATION^WA\r\nQ^96^LARYNGEAL MASK AIRWAY^LMA\r\nQ^101^MONITOR^Mo\r\nQ^103^ROOM AIR^R/A\r\nQ^105^TRANSTRACHEAL^Tt\r\nQ^107^PENDANT CANNULA^PC\r\nQ^109^MUSTACHE CANNULA^MC\r\nQ^112^CPAP^CP\r\nQ^113^BIPAP-CPAP^PAP\r\nQ^117^BIPAP^BIP\r\nQ^119^AT REST^AR\r\nQ^120^AMBU BAG^AB\r\nQ^121^WITH ACTIVITY^Act\r\nQ^124^AFTER EXERCISE^AE\r\nQ^128^RESERVOIR CANNULA^RC\r\nV^22^PAIN^PN^PN^\r\n";

var expectedResult = '[{"ien":"1","name":"BLOOD PRESSURE","abbreviation":"BP","pceAbbreviation":"BP","abnormalSystolicHigh":"210","abnormalDiastolicHigh":"110","abnormalSystolicLow":"100","abnormalDiastolicLow":"60","categories":[{"ien":"1","name":"LOCATION","qualifiers":[{"ien":"1","name":"R ARM","synonym":"RA"},{"ien":"2","name":"L ARM","synonym":"LA"},{"ien":"3","name":"R LEG","synonym":"RL"},{"ien":"4","name":"L LEG","synonym":"LL"},{"ien":"23","name":"RADIAL","synonym":"Rad"},{"ien":"53","name":"FEMORAL","synonym":"Fem"},{"ien":"57","name":"BRACHIAL","synonym":"Bra"}]},{"ien":"2","name":"METHOD","qualifiers":[{"ien":"59","name":"PALPATED","synonym":"Pal"},{"ien":"60","name":"DOPPLER","synonym":"Dop"},{"ien":"64","name":"CUFF","synonym":"Cu"},{"ien":"65","name":"NON-INVASIVE","synonym":"N-I"},{"ien":"98","name":"CUFF-AUTOMATED","synonym":"CA"},{"ien":"101","name":"MONITOR","synonym":"Mo"},{"ien":"110","name":"CUFF-MANUAL","synonym":"CM"},{"ien":"119","name":"AT REST","synonym":"AR"},{"ien":"121","name":"WITH ACTIVITY","synonym":"Act"},{"ien":"122","name":"INVASIVE","synonym":"I"},{"ien":"123","name":"ARTERIAL LINE","synonym":"AL"},{"ien":"124","name":"AFTER EXERCISE","synonym":"AE"}]},{"ien":"3","name":"POSITION","qualifiers":[{"ien":"50","name":"SITTING","synonym":"Sit"},{"ien":"51","name":"STANDING","synonym":"St"},{"ien":"52","name":"LYING","synonym":"Ly"},{"ien":"104","name":"SEMIFOWLERS","synonym":"Sfl"},{"ien":"116","name":"TRENDELENBURG","synonym":"Tr"}]},{"ien":"6","name":"CUFF SIZE","qualifiers":[{"ien":"66","name":"ADULT","synonym":"Ad"},{"ien":"67","name":"SM ADULT","synonym":"SmA"},{"ien":"68","name":"LG ADULT","synonym":"LgA"},{"ien":"70","name":"PEDIATRIC","synonym":"Ped"},{"ien":"90","name":"ADULT CUFF","synonym":"AC"},{"ien":"100","name":"LG ADULT CUFF","synonym":"LAC"},{"ien":"102","name":"PEDIATRIC CUFF","synonym":"PdC"},{"ien":"125","name":"SM ADULT CUFF","synonym":"SAC"},{"ien":"126","name":"THIGH CUFF","synonym":"ThC"}]}]},{"ien":"2","name":"TEMPERATURE","abbreviation":"T","pceAbbreviation":"TMP","abnormalHigh":"102","abnormalLow":"95","categories":[{"ien":"1","name":"LOCATION","qualifiers":[{"ien":"5","name":"AXILLARY","synonym":"Ax"},{"ien":"6","name":"ORAL","synonym":"O"},{"ien":"7","name":"RECTAL","synonym":"R"},{"ien":"40","name":"CORE","synonym":"C"},{"ien":"45","name":"TYMPANIC","synonym":"Tym"},{"ien":"46","name":"SKIN","synonym":"Sk"},{"ien":"97","name":"TEMPORAL","synonym":"Tem"}]}]},{"ien":"3","name":"RESPIRATION","abbreviation":"R","pceAbbreviation":"RS","abnormalHigh":"30","abnormalLow":"8","categories":[{"ien":"2","name":"METHOD","qualifiers":[{"ien":"47","name":"SPONTANEOUS","synonym":"S"},{"ien":"48","name":"CONTROLLED VENTILATOR","synonym":"CV"},{"ien":"49","name":"ASSISTED VENTILATOR","synonym":"AV"},{"ien":"88","name":"VENTILATOR","synonym":"Ven"},{"ien":"101","name":"MONITOR","synonym":"Mo"},{"ien":"119","name":"AT REST","synonym":"AR"},{"ien":"121","name":"WITH ACTIVITY","synonym":"Act"},{"ien":"124","name":"AFTER EXERCISE","synonym":"AE"}]},{"ien":"3","name":"POSITION","qualifiers":[{"ien":"50","name":"SITTING","synonym":"Sit"},{"ien":"51","name":"STANDING","synonym":"St"},{"ien":"52","name":"LYING","synonym":"Ly"}]}]},{"ien":"5","name":"PULSE","abbreviation":"P","pceAbbreviation":"PU","abnormalHigh":"120","abnormalLow":"60","categories":[{"ien":"1","name":"LOCATION","qualifiers":[{"ien":"22","name":"APICAL","synonym":"Ap"},{"ien":"23","name":"RADIAL","synonym":"Rad"},{"ien":"24","name":"PERIPHERAL","synonym":"Per"},{"ien":"25","name":"BILATERAL PERIPHERALS","synonym":"BiP"},{"ien":"38","name":"CAROTID","synonym":"Car"},{"ien":"39","name":"OTHER","synonym":"Oth"},{"ien":"53","name":"FEMORAL","synonym":"Fem"},{"ien":"54","name":"POPLITEAL","synonym":"Pop"},{"ien":"55","name":"POSTERIOR TIBIAL","synonym":"PT"},{"ien":"56","name":"DORSALIS PEDIS","synonym":"DP"},{"ien":"57","name":"BRACHIAL","synonym":"Bra"},{"ien":"58","name":"ULNAR","synonym":"Uln"},{"ien":"118","name":"AV FISTULA","synonym":"AVF"}]},{"ien":"2","name":"METHOD","qualifiers":[{"ien":"59","name":"PALPATED","synonym":"Pal"},{"ien":"60","name":"DOPPLER","synonym":"Dop"},{"ien":"61","name":"AUSCULTATE","synonym":"Aus"},{"ien":"65","name":"NON-INVASIVE","synonym":"N-I"},{"ien":"99","name":"LEAD","synonym":"L"},{"ien":"101","name":"MONITOR","synonym":"Mo"},{"ien":"119","name":"AT REST","synonym":"AR"},{"ien":"121","name":"WITH ACTIVITY","synonym":"Act"},{"ien":"122","name":"INVASIVE","synonym":"I"},{"ien":"124","name":"AFTER EXERCISE","synonym":"AE"}]},{"ien":"3","name":"POSITION","qualifiers":[{"ien":"50","name":"SITTING","synonym":"Sit"},{"ien":"51","name":"STANDING","synonym":"St"},{"ien":"52","name":"LYING","synonym":"Ly"},{"ien":"104","name":"SEMIFOWLERS","synonym":"Sfl"}]},{"ien":"5","name":"SITE","qualifiers":[{"ien":"62","name":"RIGHT","synonym":"Rt"},{"ien":"63","name":"LEFT","synonym":"Lt"}]}]},{"ien":"8","name":"HEIGHT","abbreviation":"HT","pceAbbreviation":"HT","categories":[{"ien":"4","name":"QUALITY","qualifiers":[{"ien":"42","name":"ACTUAL","synonym":"A"},{"ien":"43","name":"ESTIMATED","synonym":"E"},{"ien":"114","name":"STATED","synonym":"Sta"},{"ien":"127","name":"ESTIMATED BY ARM SPAN","synonym":"EAS"}]}]},{"ien":"9","name":"WEIGHT","abbreviation":"WT","pceAbbreviation":"WT","categories":[{"ien":"2","name":"METHOD","qualifiers":[{"ien":"71","name":"CHAIR","synonym":"Ch"},{"ien":"72","name":"BED","synonym":"B"},{"ien":"91","name":"STANDING WEIGHT","synonym":"SW"},{"ien":"92","name":"WITH CAST OR BRACE","synonym":"WCB"},{"ien":"93","name":"WITH PROSTHESIS","synonym":"WP"},{"ien":"94","name":"WITHOUT PROSTHESIS","synonym":"WOP"},{"ien":"106","name":"LIFT SCALE","synonym":"LS"},{"ien":"115","name":"WHEELCHAIR SCALE","synonym":"WcS"}]},{"ien":"4","name":"QUALITY","qualifiers":[{"ien":"42","name":"ACTUAL","synonym":"A"},{"ien":"43","name":"ESTIMATED","synonym":"E"},{"ien":"44","name":"DRY","synonym":"D"},{"ien":"114","name":"STATED","synonym":"Sta"}]}]},{"ien":"10","name":"ABDOMINAL GIRTH","abbreviation":"AG","pceAbbreviation":"AG"},{"ien":"11","name":"AUDIOMETRY","abbreviation":"AUD","pceAbbreviation":"AUD"},{"ien":"12","name":"FUNDAL HEIGHT","abbreviation":"FH","pceAbbreviation":"FH"},{"ien":"13","name":"FETAL HEART TONES","abbreviation":"FT","pceAbbreviation":"FT"},{"ien":"14","name":"HEAD CIRCUMFERENCE","abbreviation":"HC","pceAbbreviation":"HC"},{"ien":"15","name":"HEARING","abbreviation":"HE","pceAbbreviation":"HE"},{"ien":"16","name":"TONOMETRY","abbreviation":"TON","pceAbbreviation":"TON"},{"ien":"17","name":"VISION CORRECTED","abbreviation":"VC","pceAbbreviation":"VC"},{"ien":"18","name":"VISION UNCORRECTED","abbreviation":"VU","pceAbbreviation":"VU"},{"ien":"19","name":"CENTRAL VENOUS PRESSURE","abbreviation":"CVP","pceAbbreviation":"","abnormalHigh":"80","abnormalLow":"10","abnormalO2Saturation":"50"},{"ien":"20","name":"CIRCUMFERENCE/GIRTH","abbreviation":"CG","pceAbbreviation":"","categories":[{"ien":"1","name":"LOCATION","qualifiers":[{"ien":"39","name":"OTHER","synonym":"Oth"},{"ien":"69","name":"THIGH","synonym":"Thi"},{"ien":"73","name":"HEAD","synonym":"Hd"},{"ien":"74","name":"ABDOMINAL","synonym":"Abd"},{"ien":"75","name":"CALF","synonym":"Clf"},{"ien":"76","name":"LOWER ARM","synonym":"LrA"},{"ien":"77","name":"UPPER ARM","synonym":"UpA"},{"ien":"78","name":"WRIST","synonym":"Wri"},{"ien":"79","name":"ANKLE","synonym":"Ank"},{"ien":"108","name":"NECK","synonym":"Ne"},{"ien":"111","name":"KNEE","synonym":"Kn"},{"ien":"129","name":"HIP","synonym":"Hip"}]},{"ien":"5","name":"SITE","qualifiers":[{"ien":"62","name":"RIGHT","synonym":"Rt"},{"ien":"63","name":"LEFT","synonym":"Lt"}]}]},{"ien":"21","name":"PULSE OXIMETRY","abbreviation":"PO2","pceAbbreviation":"PO2","categories":[{"ien":"2","name":"METHOD","qualifiers":[{"ien":"48","name":"CONTROLLED VENTILATOR","synonym":"CV"},{"ien":"49","name":"ASSISTED VENTILATOR","synonym":"AV"},{"ien":"80","name":"MASK","synonym":"M"},{"ien":"81","name":"T-PIECE","synonym":"TP"},{"ien":"82","name":"FACE TENT","synonym":"FT"},{"ien":"83","name":"AEROSOL/HUMIDIFIED MASK","synonym":"AM"},{"ien":"84","name":"NASAL CANNULA","synonym":"NC"},{"ien":"85","name":"NON RE-BREATHER","synonym":"NRB"},{"ien":"86","name":"PARTIAL RE-BREATHER","synonym":"PRB"},{"ien":"87","name":"TRACHEOSTOMY COLLAR","synonym":"TC"},{"ien":"88","name":"VENTILATOR","synonym":"Ven"},{"ien":"89","name":"VENTURI MASK","synonym":"VM"},{"ien":"95","name":"WITH AMBULATION","synonym":"WA"},{"ien":"96","name":"LARYNGEAL MASK AIRWAY","synonym":"LMA"},{"ien":"101","name":"MONITOR","synonym":"Mo"},{"ien":"103","name":"ROOM AIR","synonym":"R/A"},{"ien":"105","name":"TRANSTRACHEAL","synonym":"Tt"},{"ien":"107","name":"PENDANT CANNULA","synonym":"PC"},{"ien":"109","name":"MUSTACHE CANNULA","synonym":"MC"},{"ien":"112","name":"CPAP","synonym":"CP"},{"ien":"113","name":"BIPAP-CPAP","synonym":"PAP"},{"ien":"117","name":"BIPAP","synonym":"BIP"},{"ien":"119","name":"AT REST","synonym":"AR"},{"ien":"120","name":"AMBU BAG","synonym":"AB"},{"ien":"121","name":"WITH ACTIVITY","synonym":"Act"},{"ien":"124","name":"AFTER EXERCISE","synonym":"AE"},{"ien":"128","name":"RESERVOIR CANNULA","synonym":"RC"}]}]},{"ien":"22","name":"PAIN","abbreviation":"PN","pceAbbreviation":"PN"}]';



describe('unit test to validate vitals', function() {
    beforeEach(function() {
    });

    it("parse the RPC data correctly", function () {
        runs(function () {
            var result = parseRpc(log, message2parse);
            result = JSON.stringify(result);
            expect(result).toBe(expectedResult);
        });
    });
});
